<!DOCTYPE html><html>
<head>
  <title>SENSORY RESIDENCE SECURE ENTRY SYSTEM</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background-color: #e9f5e9; padding: 20px; text-transform: uppercase; }
    h2 { color: #2b7a2b; text-align: center; margin: 5px 0 30px; }
    .top-action { text-align: center; margin-bottom: 18px; }
    .btn-3d { background: linear-gradient(145deg, #3bd97b 0%, #2b7a2b 100%); color: #fff; border: none; border-radius: 12px;
      font-size: 16px; font-weight: bold; padding: 13px 30px; box-shadow: 0 4px 16px #bbdfbb, 0 1.5px 3px #3333;
      letter-spacing: 2px; cursor: pointer; margin-bottom: 5px; transition: box-shadow 0.18s, transform 0.1s; }
    .btn-3d:active { box-shadow: 0 2px 5px #bbb; transform: translateY(2px); }
    .submit-3d { margin-top: 18px; width: 100%; }
    .photo-label { color: #2b7a2b; font-weight: bold; font-size: 15px; margin-bottom: 5px; display: block; }
    .image-container { position: relative; display: none; margin: 12px 0 15px; width: 100%; max-height: 260px;
      overflow: hidden; background-color: #f0f0f0; border: 1px solid #2b7a2b; border-radius: 4px; }
    .image-container img { width: 100%; height: auto; object-fit: cover; }
    .watermark { position: absolute; bottom: 80px; right: 8px; color: red; font-size: 14px; font-weight: bold;
      letter-spacing: 2px; pointer-events: none; }
    label { display: block; margin-top: 14px; color: #2b7a2b; font-weight: bold; }
    input, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #2b7a2b;
      border-radius: 4px; text-transform: uppercase; background-color: #e9f7ff; box-sizing: border-box;
      font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; }
    .phone-container { display: flex; align-items: center; margin-bottom: 30px; }
    .phone-container input { flex: 1; margin-right: 6px; }
    .call-btn-3d { display: none; background: linear-gradient(145deg, #41e671 0%, #176B39 100%);
      border: none; border-radius: 100%; width: 60px; height: 60px; box-shadow: 0 3px 10px #8ed5a3, 0 1.5px 3px #3333;
      justify-content: center; align-items: center; cursor: pointer; transition: box-shadow 0.18s, transform 0.1s;
      margin-left: 5px; text-decoration: none; }
    .call-btn-3d span { font-size: 16px; color: #fff; }
    .call-btn-3d:active { box-shadow: 0 2px 5px #bbb; transform: translateY(2px) scale(0.98); }
    .footer { text-align: center; padding: 5px; font-size: 11px; color: #888; margin: 30px 0 1px; font-weight: bold; }
    /* Camera modal */
    .camera-modal { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.85); z-index: 99999; display: flex; justify-content: center;
      align-items: center; flex-direction: column; }
    .camera-container { position: relative; width: 94vw; max-width: 400px; aspect-ratio: 4/3;
      background: #000; border-radius: 14px; overflow: hidden; }
    #camera-video { width: 100%; height: auto; border-radius: 14px; background: #222; }
    .guideline { position: absolute; border: 3px solid #28cc6c; border-radius: 8px;
      left: 4%; top: 4%; width: 92%; height: 92%; pointer-events: none; box-sizing: border-box; }
    .close-cam-btn { position: absolute; top: 10px; right: 13px; background: #fff; color: #1c7e41;
      border: none; border-radius: 24px; font-size: 21px; padding: 4px 13px; font-weight: bold;
      cursor: pointer; box-shadow: 0 2px 10px #aaa; }
    .capture-btn-3d { display: flex; justify-content: center; align-items: center;
      background: linear-gradient(145deg, #41e671 0%, #176B39 100%); border: none; border-radius: 100%;
      width: 60px; height: 60px; font-size: 17px; font-weight: bold;
      box-shadow: 0 3px 10px #8ed5a3, 0 1.5px 3px #3333; cursor: pointer; letter-spacing: 1.5px;
      transition: box-shadow 0.18s, transform 0.1s; margin-top: 16px; }
    .capture-btn-3d:active { box-shadow: 0 2px 5px #bbb; transform: translateY(2px) scale(0.98); }
    @media (max-width: 500px) { .camera-container { max-width: 98vw; } }
  </style>
</head>
<body>
  <h2>SENSORY RESIDENCE SECURE ENTRY SYSTEM</h2>
  <div class="top-action">
    <button type="button" id="takePhotoBtn" class="btn-3d" onclick="openCamera()">TAKE PICTURE</button>
    <span class="photo-label">Take photo of MyKad/Licence</span>
  </div>
  <div class="image-container" id="imageContainer">
    <img id="preview" src="#" alt="IMAGE PREVIEW">
    <div class="watermark">SENSORY USE ONLY</div>
  </div>
  <form id="registrationForm" autocomplete="off">
    <label for="namePassport">NAME</label>
    <input type="text" id="namePassport" name="namePassport" required><label for="mykadPassport">MYKAD / PASSPORT</label>
<input type="text" id="mykadPassport" name="mykadPassport" required>

<label for="regnum">REGISTRATION NUMBER</label>
<input type="text" id="regnum" name="regnum" required>

<label for="contact">CONTACT NUMBER</label>
<div class="phone-container">
  <input type="tel" id="contact" name="contact" required oninput="updateCallLink()" maxlength="15" inputmode="numeric" pattern="[0-9]*">
  <a id="callBtn" class="call-btn-3d" title="Call this number" target="_blank"><span>ðŸ“ž</span></a>
</div>

<label for="remark">CATEGORY</label>
<select id="remark" name="remark" required>
  <option value="-PLEASE SELECT-">-PLEASE SELECT-</option>
  <option value="DROP OFF/PICK UP">DROP OFF/PICK UP</option>
  <option value="E-HAILING">E-HAILING</option>
  <option value="FLASH EXPRESS">FLASH EXPRESS</option>
  <option value="FOOD PANDA">FOOD PANDA</option>
  <option value="GDEX">GDEX</option>
  <option value="GRAB FOOD">GRAB FOOD</option>
  <option value="J&T EXPRESS">J&T EXPRESS</option>
  <option value="LALAMOVE">LALAMOVE</option>
  <option value="LAZADA">LAZADA</option>
  <option value="MCD FOOD DELIVERY">MCD FOOD DELIVERY</option>
  <option value="OWNER">OWNER</option>
  <option value="SHOPEE EXPRESS">SHOPEE EXPRESS</option>
  <option value="SHOPEE FOOD">SHOPEE FOOD</option>
  <option value="TENANT">TENANT</option>
  <option value="OTHER">OTHER</option>
</select>
<input type="text" id="unitNumber" name="unitNumber" placeholder="UNIT NUMBER" style="display:none; margin-top:10px;">
<input type="text" id="otherCategory" name="otherCategory" placeholder="PLEASE SPECIFY" style="display:none; margin-top:10px;">

<label for="reason" id="reasonLabel" style="display:none; margin-top:14px;">REASON</label>
<select id="reason" name="reason" style="display:none;">
  <option value="-PLEASE SELECT-">-PLEASE SELECT-</option>
  <option value="Blocked card">Blocked card</option>
  <option value="Lost card">Lost card</option>
  <option value="Forget card">Forget card</option>
</select>

<label for="tower">TOWER</label>
<select id="tower" name="tower" required>
  <option value="-PLEASE SELECT-">-PLEASE SELECT-</option>
  <option value="TOWER A">TOWER A</option>
  <option value="TOWER B">TOWER B</option>
  <option value="TOWER A & B">TOWER A & B</option>
</select>

<input type="file" accept="image/*" capture="environment" id="imageInput" style="display:none;">
<button type="submit" class="btn-3d submit-3d">SUBMIT</button>

  </form>
  <div class="footer">POWERED BY MRED TECH</div>  <!-- MODAL CAMERA -->  <div id="cameraModal" class="camera-modal" style="display:none;">
    <div class="camera-container">
      <video id="camera-video" autoplay playsinline></video>
      <div class="guideline"></div>
      <button class="close-cam-btn" type="button" onclick="closeCameraModal()">Ã—</button>
    </div>
    <button class="capture-btn-3d" type="button" onclick="captureImage()"></button>
  </div>  <script>
    // Camera functions
    let stream, video;
    async function startCamera() {
      video = document.getElementById('camera-video');
      try { stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } }); video.srcObject = stream; }
      catch(e){ alert('Failed to open camera: '+e.message); closeCameraModal(); }
    }
    function openCamera(){ document.getElementById('cameraModal').style.display='flex'; startCamera(); }
    function closeCameraModal(){ document.getElementById('cameraModal').style.display='none'; if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; }}
    function captureImage(){
      const cont=document.querySelector('.camera-container'), guid=document.querySelector('.guideline');
      const r=guid.getBoundingClientRect(), c=cont.getBoundingClientRect();
      const ratios={ x:(r.left-c.left)/c.width, y:(r.top-c.top)/c.height, w:r.width/c.width, h:r.height/c.height };
      const canvas=document.createElement('canvas'); canvas.width=video.videoWidth; canvas.height=video.videoHeight;
      const ctx=canvas.getContext('2d'); ctx.drawImage(video,0,0,canvas.width,canvas.height);
      const crop=document.createElement('canvas'); crop.width=canvas.width*ratios.w; crop.height=canvas.height*ratios.h;
      crop.getContext('2d').drawImage(canvas,canvas.width*ratios.x,canvas.height*ratios.y,crop.width,crop.height,0,0,crop.width,crop.height);
      const dataUrl=crop.toDataURL('image/jpeg',0.7);
      document.getElementById('preview').src=dataUrl; document.getElementById('imageContainer').style.display='block'; closeCameraModal();
      (async()=>{ try{ document.body.style.cursor='progress'; const res=await fetch('https://sensory-vision.edreborn86.workers.dev',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({image:dataUrl.split(',',1)[1]})}); const r2=await res.json(); document.body.style.cursor='default'; if(r2.name)document.getElementById('namePassport').value=r2.name.toUpperCase(); if(r2.idnum)document.getElementById('mykadPassport').value=r2.idnum.toUpperCase(); }catch(err){document.body.style.cursor='default';alert('Autofill GAGAL: '+err.message);} })();
    }
    document.getElementById('imageInput').addEventListener('change',async e=>{
      const file=e.target.files[0]; if(!file)return; const reader=new FileReader(); reader.onload=()=>{
        const img=new Image(); img.onload=()=>{ const c=document.createElement('canvas'),s=Math.min(1,800/img.width); c.width=img.width*s; c.height=img.height*s; c.getContext('2d').drawImage(img,0,0,c.width,c.height); const data=c.toDataURL('image/jpeg',0.7); document.getElementById('preview').src=data; document.getElementById('imageContainer').style.display='block'; (async()=>{ try{ const res=await fetch('https://sensory-vision.edreborn86.workers.dev',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({image:data.split(',',1)[1]})}); const r=await res.json(); if(r.name)document.getElementById('namePassport').value=r.name.toUpperCase(); if(r.idnum)document.getElementById('mykadPassport').value=r.idnum.toUpperCase(); }catch(err){alert('Autofill GAGAL: '+err.message);} })(); }; img.src=reader.result; }; reader.readAsDataURL(file);
    });

    // Update call button
    function updateCallLink(){ const p=document.getElementById('contact').value.trim(); const btn=document.getElementById('callBtn'); if(p.length>=10){btn.href='tel:'+p;btn.style.display='flex';}else btn.style.display='none'; }
    document.getElementById('callBtn').addEventListener('click',e=>{ if(document.getElementById('contact').value.trim().length<10)e.preventDefault(); });

    // Enter key: navigate and open dropdowns
    const formEls = Array.from(document.getElementById('registrationForm').elements)
      .filter(el => (el.tagName==='INPUT' || el.tagName==='SELECT') && !el.disabled && el.type!=='hidden');
    formEls.forEach((el, i) => el.addEventListener('keydown', e => {
      if (e.key==='Enter'){
        e.preventDefault();
        const next = formEls[i+1];
        if (next) {
          next.focus();
          if (next.tagName==='SELECT') next.size = next.options.length;
        }
      }
    }));
    // Reset size on select blur/change
    formEls.filter(el=>el.tagName==='SELECT').forEach(sel=>{
      sel.addEventListener('change',()=>sel.size=1);
      sel.addEventListener('blur',()=>sel.size=1);
    });

    // Category & reason logic
    const remark=document.getElementById('remark'), unit=document.getElementById('unitNumber'), other=document.getElementById('otherCategory'), reason=document.getElementById('reason'), rLabel=document.getElementById('reasonLabel');
    remark.addEventListener('change',function(){ const v=this.value; other.style.display=v==='OTHER'?'block':'none'; unit.style.display=(v==='OWNER'||v==='TENANT')?'block':'none'; rLabel.style.display=(v==='OWNER'||v==='TENANT')?'block':'none'; reason.style.display=(v==='OWNER'||v==='TENANT')?'block':'none'; if(v!=='OTHER')other.value=''; if(v!=='OWNER'&&v!=='TENANT'){unit.value=''; reason.value='-PLEASE SELECT-';} });

    // Submit data
    document.getElementById('registrationForm').addEventListener('submit',async e=>{
      e.preventDefault();
      const cat=remark.value, oth=other.value.trim(), uni=unit.value.trim(), rea=reason.value;
      if(cat==='OTHER'&&oth===''){return alert('PLEASE SPECIFY OTHER CATEGORY.');}
      if((cat==='OWNER'||cat==='TENANT')&&uni===''){return alert('PLEASE ENTER UNIT NUMBER.');}
      if((cat==='OWNER'||cat==='TENANT')&&rea==='-PLEASE SELECT-'){return alert('PLEASE SELECT REASON.');}
      const data={ namePassport:document.getElementById('namePassport').value, mykadPassport:document.getElementById('mykadPassport').value, regnum:document.getElementById('regnum').value, contact:document.getElementById('contact').value, remark:cat, tower:document.getElementById('tower').value, otherCategory:cat==='OTHER'?oth:'', unitNumber:(cat==='OWNER'||cat==='TENANT')?uni:'', reason:(cat==='OWNER'||cat==='TENANT')?rea:'', imageUrl:document.getElementById('preview').src };
      try{ const res=await fetch('https://ext-gs12.edreborn86.workers.dev',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)}); const r=await res.json(); r.success?alert('Data submitted!'):alert('Submit failed: '+(r.message||'')); }
      catch(err){alert('Error submit data: '+err.message);}    });
  </script></body>
</html>
