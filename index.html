<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Camera Crop MyKad/Licence</title>
  <style>
    body {
      background: #e9f5e9;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    .camera-wrap {
      position: relative;
      display: inline-block;
      margin-top: 20px;
    }
    #videoPreview {
      width: 90vw;
      max-width: 420px;
      border-radius: 12px;
      box-shadow: 0 3px 16px #aaa7;
    }
    #frameOverlay {
      position: absolute;
      /* Responsive frame: adjust as needed */
      left: 13%; top: 24%;
      width: 74%; height: 36%;
      border: 3px solid #17a84b;
      border-radius: 16px;
      box-sizing: border-box;
      pointer-events: none;
      z-index: 10;
    }
    #captureBtn {
      margin: 24px 0 12px 0;
      padding: 14px 40px;
      background: linear-gradient(135deg, #17a84b, #63db94 90%);
      color: #fff;
      font-weight: bold;
      border: none;
      border-radius: 16px;
      font-size: 1.2em;
      box-shadow: 0 4px 18px #b5e1c0;
      cursor: pointer;
      transition: filter 0.14s;
    }
    #captureBtn:active { filter: brightness(0.9); }
    #previewBox {
      margin: 18px auto;
      display: none;
    }
    #previewImage {
      border: 2px solid #ccc;
      border-radius: 12px;
      width: 90vw;
      max-width: 420px;
      box-shadow: 0 2px 12px #aaa5;
    }
    .desc {
      color: #16702e;
      font-weight: bold;
      margin: 10px 0;
      font-size: 1.05em;
    }
  </style>
</head>
<body>
  <h2>Ambil Gambar MyKad/Lesen/Passport</h2>
  <div class="desc">Sila letakkan dokumen di dalam kotak hijau sebelum ambil gambar.</div>
  <div class="camera-wrap">
    <video id="videoPreview" autoplay playsinline></video>
    <div id="frameOverlay"></div>
  </div>
  <div>
    <button id="captureBtn">Take Picture</button>
  </div>
  <div id="previewBox">
    <div class="desc">Preview (gambar yang akan dihantar)</div>
    <img id="previewImage" src="#" alt="Preview" />
  </div>

<script>
let video = document.getElementById('videoPreview');
let frameOverlay = document.getElementById('frameOverlay');
let previewBox = document.getElementById('previewBox');
let previewImage = document.getElementById('previewImage');

// Aktif kamera belakang (prefer mobile)
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: { exact: "environment" } }
    });
    video.srcObject = stream;
  } catch (err) {
    // fallback to any camera if env not found
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
  }
}
startCamera();

// Crop + compress ikut kawasan frame
document.getElementById('captureBtn').onclick = function() {
  // Ratio dan posisi frame overlay (sama macam CSS)
  const vw = video.videoWidth;
  const vh = video.videoHeight;
  // RATIO MESTI SAMA DGN CSS: left:13% top:24% width:74% height:36%
  const sx = Math.floor(vw * 0.13);
  const sy = Math.floor(vh * 0.24);
  const sw = Math.floor(vw * 0.74);
  const sh = Math.floor(vh * 0.36);

  // Canvas untuk crop
  const canvas = document.createElement('canvas');
  canvas.width = sw;
  canvas.height = sh;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, sx, sy, sw, sh, 0, 0, sw, sh);

  // Compress ke JPEG 0.7 quality
  const base64 = canvas.toDataURL('image/jpeg', 0.7);

  // Preview gambar
  previewImage.src = base64;
  previewBox.style.display = 'block';

  // Boleh terus upload base64 ke server/Google Sheet
  // contoh: sendToServer(base64);
};
</script>
</body>
</html>
